#!/usr/bin/env nix-shell
#!nix-shell -i zsh

set -e

# suppress "zsh no matches found"
setopt +o nomatch
autoload -U age

AGEREF=$(stat -c %y ~/.xmonad/xmonad-x86_64-linux)
OLD=$(ls *(+age) | grep -E '*.hs' | wc -l)

compile () {
  [[ -a cabal.project.local ]] || cabal configure --enable-optimisation --enable-library-stripping

  cabal build

  fd -tf 'xmonad' dist -x mv -u {} "~/.xmonad/xmonad-x86_64-linux"
}


# [[ $OLD > 0 ]] && compile
compile
