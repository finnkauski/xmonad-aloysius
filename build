#! /usr/bin/env nix-shell
#! nix-shell -i zsh

# suppress "zsh no matches found"
setopt +o nomatch

cd ~/.xmonad
OLD=$(ls *(.mM+1) 2>/dev/null | grep xmonad-x64_64-linux)

doBuild () {
  
  # set up the compile flags
  [[ -a cabal.project.local ]] || cabal new-configure --enable-optimisation --enable-library-stripping
  
  # build
  cabal new-build

  # replace 
  cp -p -update dist-newstyle/**/build/xmonad/xmonad xmonad-x86_64-linux
 
  # restart xmonad
  xmonad --restart
}

[[ "$OLD" -ne "" ]] && doBuild
